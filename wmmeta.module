<?php

use Drupal\wmmeta\Event\MetaFormAlterEvent;
use Drupal\wmmeta\WmmetaEvents;

function wmmeta_cron()
{
    \Drupal::getContainer()->get('wmmeta.scheduler')->runSchedule();
}

function wmmeta_theme()
{
    return [
        'meta_head_tags' => [
            'variables' => [
                'meta' => \Drupal::getContainer()->get('wmmeta.meta')->getDefaultMetaData(),
            ],
            'path' => drupal_get_path('module', 'wmmeta') . DIRECTORY_SEPARATOR . 'templates',
            'template' => 'head_tags',
        ]
    ];
}

function wmmeta_preprocess_html(&$variables)
{
    $variables['metaHeadTags'] = [
        '#theme' => 'meta_head_tags',
        '#meta' => \Drupal::getContainer()->get('wmmeta.meta')->getMetaData(),
    ];
}

function wmmeta_inline_entity_form_entity_form_alter(&$entity_form)
{
    if (
        $entity_form['#entity_type'] !== 'meta'
        || $entity_form['#bundle'] !== 'meta'
    ) {
        return;
    }

    Drupal::getContainer()->get('event_dispatcher')
        ->dispatch(WmmetaEvents::META_FORM_ALTER, new MetaFormAlterEvent($entity_form));
}
